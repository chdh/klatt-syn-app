<!DOCTYPE html>
<html>
<head>
 <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
 <link rel="stylesheet" href="app.css">
 <script src="app.js"></script>
 <title>KlattSyn - Klatt Formant Synthesizer</title>
</head>
<body class="klattSynApp">

<script>
 if (!window.Promise) {
    document.write('<p style="color: red; font-size: 20px; font-weight: bold;">Sorry, your web browser is outdated and cannot run this application!</p>'); }
</script>

<h1>KlattSyn - Klatt Formant Synthesizer</h1>


<div id="inputParms">

 <div class="parmBlock">
  <div class="parmField">
   <label class="w-lbl" for="glottalSourceType">Glottal source:</label>
   <select class="w-inp" id="glottalSourceType">
    <option value="impulsive">Impulsive</option>
    <option value="natural">Natural</option>
    <option value="noise">White noise</option>
   </select>
  </div>
  <div class="parmField">
   <label class="w-lbl" for="sampleRate">Sample rate [Hz]:</label>
   <input class="w-inp" id="sampleRate" type="number" step="any" required>
  </div>
  <div class="parmField" data-info="Duration of fade-in and fade-out.">
   <label class="w-lbl" for="fadingDuration">Fading [s]:</label>
   <input class="w-inp" id="fadingDuration" type="number" step="any" min="0" required>
  </div>
  <div class="parmField" data-info="Window function for displaying the spectrum.">
   <label class="w-lbl" for="windowFunction">Window function:</label>
   <select class="w-inp" id="windowFunction"></select>
  </div>
 </div>

 <div class="parmHeading2">Frame</div>

 <div class="parmBlock">
  <div class="parmField">
   <label class="w-lbl" for="duration">Duration [s]:</label>
   <input class="w-inp" id="duration" type="number" step="any" min="0" required>
  </div>
  <div class="parmField" data-info="Fundamental frequency.">
   <label class="w-lbl" for="f0">F0 [Hz]:</label>
   <input class="w-inp" id="f0" type="number" step="any" min="0" required>
  </div>
  <div class="parmField" data-info="F0 flutter level. A value between 0 and normally 1.">
   <label class="w-lbl" for="flutterLevel">Flutter:</label>
   <input class="w-inp" id="flutterLevel" type="number" step="any" min="0" required>
  </div>
  <div class="parmField" data-info="Open phase ratio. Relative length of the open phase of the glottis. A value between 0 and 1.">
   <label class="w-lbl" for="openPhaseRatio">Open phase:</label>
   <input class="w-inp" id="openPhaseRatio" type="number" step="any" min="0" max="1" required>
  </div>
  <div class="parmField" data-info="Breathiness in voicing (turbulence) in dB. Positive to amplify, negative to attenuate.">
   <label class="w-lbl" for="breathinessDb">Breathiness [dB]:</label>
   <input class="w-inp" id="breathinessDb" type="number" step="any" required>
  </div>
  <div class="parmField" data-info="Spectral tilt for glottal source in dB. A positive number that specifies the attenuation at 3 kHz. 0 = no tilt.">
   <label class="w-lbl" for="tiltDb">Tilt [dB]:</label>
   <input class="w-inp" id="tiltDb" type="number" step="any" min="0" required>
  </div>
  <div class="parmField" data-info="Overall gain (output gain) in dB. Positive to amplify or negative to attenuate the signal, empty for automatic gain (AGC).">
   <label class="w-lbl" for="gainDb">Gain [dB]:</label>
   <input class="w-inp" id="gainDb" type="number" step="any" placeholder="(auto)">
  </div>
  <div class="parmField" data-info="RMS level for automatic gain control (AGC), only relevant when the gain parameter field is empty.">
   <label class="w-lbl" for="agcRmsLevel">AGC RMS level:</label>
   <input class="w-inp" id="agcRmsLevel" type="number" step="any" min="0" required>
  </div>
 </div>

 <div class="formantBlock1">
  <div class="parmField" data-info="Formant frequencies">
   <div class="w-lbl">Formant freq. [Hz]</div>
  </div>
  <div class="formantBlock2">
   <div class="parmField" data-info="Oral formant 1 frequency in Hz.">
    <label class="w-lbl" for="f1Freq">F1:</label>
    <input class="w-inp" id="f1Freq" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 2 frequency in Hz.">
    <label class="w-lbl" for="f2Freq">F2:</label>
    <input class="w-inp" id="f2Freq" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 3 frequency in Hz.">
    <label class="w-lbl" for="f3Freq">F3:</label>
    <input class="w-inp" id="f3Freq" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 4 frequency in Hz.">
    <label class="w-lbl" for="f4Freq">F4:</label>
    <input class="w-inp" id="f4Freq" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 5 frequency in Hz.">
    <label class="w-lbl" for="f5Freq">F5:</label>
    <input class="w-inp" id="f5Freq" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 6 frequency in Hz.">
    <label class="w-lbl" for="f6Freq">F6:</label>
    <input class="w-inp" id="f6Freq" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Nasal formant frequency in Hz.">
    <label class="w-lbl" for="nasalFormantFreq">Nasal:</label>
    <input class="w-inp" id="nasalFormantFreq" type="number" step="any" min="0">
   </div>
  </div>
 </div>

 <div class="formantBlock1">
  <div class="parmField" data-info="Formant bandwidths">
   <div class="w-lbl">Formant bw. [Hz]</div>
  </div>
  <div class="formantBlock2">
   <div class="parmField" data-info="Oral formant 1 bandwidth in Hz.">
    <label class="w-lbl" for="f1Bw">B1:</label>
    <input class="w-inp" id="f1Bw" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 2 bandwidth in Hz.">
    <label class="w-lbl" for="f2Bw">B2:</label>
    <input class="w-inp" id="f2Bw" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 3 bandwidth in Hz.">
    <label class="w-lbl" for="f3Bw">B3:</label>
    <input class="w-inp" id="f3Bw" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 4 bandwidth in Hz.">
    <label class="w-lbl" for="f4Bw">B4:</label>
    <input class="w-inp" id="f4Bw" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 5 bandwidth in Hz.">
    <label class="w-lbl" for="f5Bw">B5:</label>
    <input class="w-inp" id="f5Bw" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Oral formant 6 bandwidth in Hz.">
    <label class="w-lbl" for="f6Bw">B6:</label>
    <input class="w-inp" id="f6Bw" type="number" step="any" min="0">
   </div>
   <div class="parmField" data-info="Nasal formant bandwidth in Hz.">
    <label class="w-lbl" for="nasalFormantBw">Nasal:</label>
    <input class="w-inp" id="nasalFormantBw" type="number" step="any" min="0">
   </div>
  </div>
 </div>

 <div class="parmHeading2">Cascade branch</div>

 <div class="parmBlock">
  <div class="parmField" data-info="Enable the cascade branch of the synthesizer.">
   <label class="w-lbl" for="cascadeEnabled">Cascade enable:</label>
   <div class="w-inp"><input id="cascadeEnabled" type="checkbox"></div>
  </div>
  <div class="parmField" data-info="Voicing amplitude for cascade branch in dB. Positive to amplify or negative to attenuate.">
   <label class="w-lbl" for="cascadeVoicingDb">Voicing amp. [dB]:</label>
   <input class="w-inp" id="cascadeVoicingDb" type="number" step="any" required>
  </div>
  <div class="parmField" data-info="Aspiration (glottis noise) for cascade branch in dB. Positive to amplify, negative to attenuate.">
   <label class="w-lbl" for="cascadeAspirationDb">Aspiration [dB]:</label>
   <input class="w-inp" id="cascadeAspirationDb" type="number" step="any" required>
  </div>
  <div class="parmField" data-info="Amplitude modulation factor for aspiration in cascade branch, 0 = no modulation, 1 = maximum modulation.">
   <label class="w-lbl" for="cascadeAspirationMod">Aspiration mod.:</label>
   <input class="w-inp" id="cascadeAspirationMod" type="number" step="any" min="0" max="1" required>
  </div>
  <div class="parmField" data-info="Nasal antiformant frequency in Hz.">
   <label class="w-lbl" for="nasalAntiformantFreq">Nasal anti freq. [Hz]:</label>
   <input class="w-inp" id="nasalAntiformantFreq" type="number" step="any" min="0">
  </div>
  <div class="parmField" data-info="Nasal antiformant bandwidth in Hz.">
   <label class="w-lbl" for="nasalAntiformantBw">Nasal anti bw. [Hz]:</label>
   <input class="w-inp" id="nasalAntiformantBw" type="number" step="any" min="0">
  </div>
 </div>

 <div class="parmHeading2">Parallel branch</div>

 <div class="parmBlock">
  <div class="parmField" data-info="Enable the parallel branch of the synthesizer.">
   <label class="w-lbl" for="parallelEnabled">Parallel enable:</label>
   <div class="w-inp"><input id="parallelEnabled" type="checkbox"></div>
  </div>
  <div class="parmField" data-info="Voicing amplitude for parallel branch in dB. Positive to amplify or negative to attenuate.">
   <label class="w-lbl" for="parallelVoicingDb">Voicing amp. [dB]:</label>
   <input class="w-inp" id="parallelVoicingDb" type="number" step="any" required>
  </div>
  <div class="parmField" data-info="Aspiration (glottis noise) for parallel branch in dB. Positive to amplify, negative to attenuate.">
   <label class="w-lbl" for="parallelAspirationDb">Aspiration [dB]:</label>
   <input class="w-inp" id="parallelAspirationDb" type="number" step="any" required>
  </div>
  <div class="parmField" data-info="Amplitude modulation factor for aspiration in parallel branch, 0 = no modulation, 1 = maximum modulation.">
   <label class="w-lbl" for="parallelAspirationMod">Aspiration mod.:</label>
   <input class="w-inp" id="parallelAspirationMod" type="number" step="any" min="0" max="1" required>
  </div>
  <div class="parmField" data-info="Frication noise level in dB.">
   <label class="w-lbl" for="fricationDb">Frication [dB]:</label>
   <input class="w-inp" id="fricationDb" type="number" step="any">
  </div>
  <div class="parmField" data-info="Amplitude modulation factor for frication noise in parallel branch, 0 = no modulation, 1 = maximum modulation.">
   <label class="w-lbl" for="fricationMod">Frication mod.:</label>
   <input class="w-inp" id="fricationMod" type="number" min="0" max="1" step="any">
  </div>
  <div class="parmField" data-info="Parallel bypass level in dB, used to bypass differentiated glottal and frication signals around resonators F2 to F6.">
   <label class="w-lbl" for="parallelBypassDb">Bypass [dB]:</label>
   <input class="w-inp" id="parallelBypassDb" type="number" step="any">
  </div>
 </div>

 <div class="formantBlock1">
  <div class="parmField">
   <div class="w-lbl">Formant levels [dB]</div>
  </div>
  <div class="formantBlock2">
   <div class="parmField" data-info="Oral formant 1 level in DB.">
    <label class="w-lbl" for="f1Db">L1:</label>
    <input class="w-inp" id="f1Db" type="number" step="any">
   </div>
   <div class="parmField" data-info="Oral formant 2 level in DB.">
    <label class="w-lbl" for="f2Db">L2:</label>
    <input class="w-inp" id="f2Db" type="number" step="any">
   </div>
   <div class="parmField" data-info="Oral formant 3 level in DB.">
    <label class="w-lbl" for="f3Db">L3:</label>
    <input class="w-inp" id="f3Db" type="number" step="any">
   </div>
   <div class="parmField" data-info="Oral formant 4 level in DB.">
    <label class="w-lbl" for="f4Db">L4:</label>
    <input class="w-inp" id="f4Db" type="number" step="any">
   </div>
   <div class="parmField" data-info="Oral formant 5 level in DB.">
    <label class="w-lbl" for="f5Db">L5:</label>
    <input class="w-inp" id="f5Db" type="number" step="any">
   </div>
   <div class="parmField" data-info="Oral formant 6 level in DB.">
    <label class="w-lbl" for="f6Db">L6:</label>
    <input class="w-inp" id="f6Db" type="number" step="any">
   </div>
   <div class="parmField" data-info="Nasal formant level in DB.">
    <label class="w-lbl" for="nasalFormantDb">Nasal:</label>
    <input class="w-inp" id="nasalFormantDb" type="number" step="any">
   </div>
  </div>
 </div>

</div>

<div class="actionButtons">
 <button id="synthesizeButton">Synthesize</button>
 <button id="playButton">Play</button>
 <button id="wavFileButton">WAV file</button>
 <button id="resetButton">Reset</button>
 <div class="parmField" data-info="An arbitrary text which will be stored in the URL and used in the name of the WAV file.">
  <label class="w-lbl" for="reference">Reference:</label>
  <input class="w-inp" id="reference" type="text">
 </div>
</div>

<div class="resultBlock">
 <div class="title">Signal</div>
 <canvas id="signalViewer" tabindex="-1"></canvas>
</div>
<div class="resultBlock">
 <div class="title">Spectrum</div>
 <canvas id="spectrumViewer" tabindex="-1"></canvas>
</div>

<div class="footer">
 Source code on GitHub: &nbsp;<a href="https://github.com/chdh/klatt-syn">KlattSyn</a>, &nbsp;<a href="https://github.com/chdh/klatt-syn-app">KlattSynApp</a>
</div>

</body>
</html>
